<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Proxy Streamer</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª—å –¥–ª—è —à—Ä–∏—Ñ—Ç–∞ Inter –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f8f9;
            color: #1f2937;
        }
        .container {
            max-width: 400px;
            padding: 1rem;
        }
    </style>
</head>
<body class="flex justify-center min-h-screen">
    <div class="container w-full mx-auto p-4 flex flex-col items-center">
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ -->
        <h1 class="text-3xl font-extrabold text-[#0088CC] mb-2">
            üì∫ –ü—Ä–æ–∫—Å–∏-–°—Ç—Ä–∏–º
        </h1>
        <p class="text-gray-600 text-center mb-6">
            –í–≤–µ–¥–∏—Ç–µ URL –≤–∏–¥–µ–æ –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å. –ë–æ—Ç –æ–±–æ–π–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É.
        </p>

        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
        <input id="video-input" type="text" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ YouTube –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..."
               class="w-full p-3 mb-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
               oninput="updateButtonText(this.value)">

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="flex flex-col space-y-3 w-full">
            <button id="send-button" onclick="sendData('url')"
                    class="w-full bg-[#0088CC] text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-[#0077B3] transition duration-150 disabled:opacity-50"
                    disabled>
                üîó –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –°—Å—ã–ª–∫—É
            </button>
            <button id="search-button" onclick="sendData('search')"
                    class="w-full bg-[#40C3F2] text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-[#3498DB] transition duration-150 disabled:opacity-50"
                    disabled>
                üîé –ù–∞–π—Ç–∏ –í–∏–¥–µ–æ
            </button>
        </div>

        <p id="error-message" class="text-red-500 mt-4 hidden text-sm"></p>
    </div>

    <script>
        const inputField = document.getElementById('video-input');
        const sendButton = document.getElementById('send-button');
        const searchButton = document.getElementById('search-button');
        const errorMessage = document.getElementById('error-message');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ Mini App
        tg.MainButton.setParams({
            text: '–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...',
            is_active: false,
            is_visible: false
        });

        // ------------------------------------------------
        // 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–¥–ª—è –ø–æ–∏—Å–∫–∞)
        // ------------------------------------------------
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const initialUrl = getQueryParam('url');
        if (initialUrl) {
            inputField.value = initialUrl;
            // –°—Ä–∞–∑—É –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–∏—à–µ–ª URL –∏–∑ –ø–æ–∏—Å–∫–∞
            updateButtonText(initialUrl);
            sendData('url');
        }

        // ------------------------------------------------
        // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
        // ------------------------------------------------
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (e) {
                return false;
            }
        }

        function updateButtonText(value) {
            const query = value.trim();
            const isUrl = isValidUrl(query);

            if (query.length > 0) {
                sendButton.disabled = false;
                searchButton.disabled = false;
                
                if (isUrl) {
                    sendButton.textContent = 'üîó –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –°—Å—ã–ª–∫—É (Stream)';
                    searchButton.textContent = 'üîé –ù–∞–π—Ç–∏ –ø–æ –¢–µ–∫—Å—Ç—É (Ignore URL)';
                } else {
                    sendButton.textContent = 'üîó –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –°—Å—ã–ª–∫—É (Must be URL)';
                    searchButton.textContent = 'üîé –ù–∞–π—Ç–∏ –í–∏–¥–µ–æ';
                    sendButton.disabled = true; // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Å—ã–ª–∫—É, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ URL
                }
            } else {
                sendButton.disabled = true;
                searchButton.disabled = true;
                sendButton.textContent = 'üîó –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –°—Å—ã–ª–∫—É';
                searchButton.textContent = 'üîé –ù–∞–π—Ç–∏ –í–∏–¥–µ–æ';
            }
            errorMessage.classList.add('hidden');
        }

        // ------------------------------------------------
        // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        // ------------------------------------------------
        function sendData(type) {
            const query = inputField.value.trim();
            
            if (!query) {
                errorMessage.textContent = '–ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (type === 'url' && !isValidUrl(query)) {
                errorMessage.textContent = '–î–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –±–æ—Ç—É
            const dataToSend = {
                type: type, // 'url' –∏–ª–∏ 'search'
                query: query
            };

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É —á–µ—Ä–µ–∑ WebApp SDK
            try {
                tg.sendData(JSON.stringify(dataToSend));
                tg.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            } catch (e) {
                errorMessage.textContent = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Mini App –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.';
                errorMessage.classList.remove('hidden');
                console.error("Error sending data:", e);
            }
        }

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫ –≤–≤–æ–¥—É
        inputField.addEventListener('input', (e) => updateButtonText(e.target.value));

    </script>
</body>
</html>

